<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>龙鑫商城</title>

    <link th:href="@{css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{css/fileinput.css}"rel="stylesheet" type="text/css" />
    <link th:href="@{font-awesome/css/font-awesome.css}" rel="stylesheet">
	<link th:href="@{css/themes/explorer-fa/theme.min.css}"rel="stylesheet" type="text/css" />
    <link th:href="@{css/plugins/dataTables/datatables.min.css}" rel="stylesheet">
	<link th:href="@{css/plugins/dropzone/basic.css}" rel="stylesheet">
    <link th:href="@{css/plugins/dropzone/dropzone.css}" rel="stylesheet">
    <link th:href="@{css/animate.css}" rel="stylesheet">
    <link th:href="@{css/style.css}" rel="stylesheet">
    <link th:href="@{css/circle.css}" rel="stylesheet">
    <link th:href="@{css/bootstrapValidator.min.css}" rel="stylesheet">
</head>

<body>

    <div id="wrapper">

    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                    <div class="dropdown profile-element"> <span>
                            <img alt="image" class="img-circle" src="img/profile_small.jpg" />
                             </span>
                        <a data-toggle="dropdown" class="dropdown-toggle" href="table_data_tables.html#">
                            <span class="clear"> <span class="block m-t-xs"> <strong class="font-bold">David Williams</strong>
                             </span> <!-- <span class="text-muted text-xs block">Art Director <b class="caret"></b></span> </span> --> </a>
<!--                         <ul class="dropdown-menu animated fadeInRight m-t-xs"> -->
<!--                             <li><a href="profile.html">Profile</a></li> -->
<!--                             <li><a href="contacts.html">Contacts</a></li> -->
<!--                             <li><a href="mailbox.html">Mailbox</a></li> -->
<!--                             <li class="divider"></li> -->
<!--                             <li><a href="login.html">Logout</a></li> -->
<!--                         </ul> -->
                    </div>
                    <div class="logo-element">
                        IN+
                    </div>
                </li>
                <li>
                    <a th:href="@{menu}"><i class="fa fa-th-large"></i> <span class="nav-label">商品管理</span> <span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                        <li><a th:href="@{menu}"> 菜单管理</a></li>
                        <li><a th:href="@{goods}">商品管理</a></li>
                    </ul>
                </li>
            </ul>

        </div>
    </nav>

        <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
        <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
            <ul class="nav navbar-top-links navbar-right">
                <li>
                    <span class="m-r-sm text-muted welcome-message">Welcome to INSPINIA+ Admin Theme.</span>
                </li>
                <li class="dropdown">
                    <a class="dropdown-toggle count-info" data-toggle="dropdown" href="table_data_tables.html#">
                        <i class="fa fa-bell"></i>  <span class="label label-primary">8</span>
                    </a>
                    <ul class="dropdown-menu dropdown-alerts">
                        <li>
                            <a href="mailbox.html">
                                <div>
                                    <i class="fa fa-envelope fa-fw"></i> You have 16 messages
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="profile.html">
                                <div>
                                    <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                    <span class="pull-right text-muted small">12 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        
                    </ul>
                </li>


                <li>
                    <a href="login.html">
                        <i class="fa fa-sign-out"></i> Log out
                    </a>
                </li>
            </ul>

        </nav>
        </div>
        
        <div class="modal fade" id="addGoods" tabindex="-1" role="dialog" data-backdrop="static" aria-labelledby="myModalLabel" aria-hidden="true">
		    <div class="modal-dialog">
		        <div class="modal-content">
		            <div class="modal-header">
		                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		                <h4 class="modal-title" id="myModalLabel">新增商品</h4>
		            </div>
		            <form id="addForm">
		            <div class="modal-body">
		            	<div class="row">
		            		<div class="form-group">
			            		<label class="control-label">商品名称：</label>
			            		<input type="text" name="title" id="title" class="form-control" />
		            		</div>
		            	</div>
		            	<div class="row">
		            		<div class="form-group">
			            		<label class="control-label">品牌：</label>
			            		<input type="text" name="brand" id="brand" class="form-control" />
		            		</div>
		            	</div>
		            	<div class="row">
		            		<div class="form-group col-sm-5">
		            			<div class="row">
				            		<label class="control-label">价格：</label>
				            		<input type="text" name="price" id="price" class="form-control"/>
		            			</div>
		            		</div>
		            		<div class="form-group col-sm-2"></div>
		            		<div class="form-group col-sm-5">
		            			<div class="row ">
				            		<label class="control-label">原价格：</label>
				            		<input type="text" name="oriPrice" id="oriPrice" class="form-control" value="0.00" />
		            			</div>
		            		</div>
		            	</div>
		            	<div class="row">
		            		<div class="form-group">
			            		<label class="control-label">商品规格：</label>
			            		<textarea rows="3" name="specification" style="resize: none" id="specification" class="form-control"></textarea>
		            		</div>
		            	</div>
		            	<div class="row">
		            		<div class="form-group col-sm-5">
		            			<div class="row">
				            		<label class="control-label">邮费：</label>
				            		<input type="text" name="carriage" id="carriage" class="form-control"/>
		            			</div>
		            		</div>
		            		<div class="form-group col-sm-2"></div>
		            		<div class="form-group col-sm-5">
		            			<div class="row">
				            		<label class="control-label">库存：</label>
				            		<input type="text" name="inventory" id="inventory" class="form-control" value="0"/>
		            			</div>
		            		</div>
		            	</div>
		            	<div class="row">
		            		<div class="form-group">
			            		<label class="control-label">商品描述：</label>
			            		<input type="text" name="goodsDesc" id="goodsDesc" class="form-control" />
		            		</div>
		            	</div>
		            	<div class="row">
		            		<div class="form-group">
			            		<label class="control-label">分类：</label>
			            		<select name="menuId" id="menuId" class="form-control">
			            		 	<option value="0" selected="selected" >选择分类...</option>
                                    <option th:each="menu:${menus}" th:value="${menu.id}" th:text="${menu.menuName}"></option>
                                </select>
			            	</div>
		            	</div>
		            	<div class="row">
		            		<div class="form-group">
			            		<label class="control-label">商品图片：</label>
			            		<input type="file" name="goodsimg" id="goodsimg" class="file-loading form-control" />
			            	</div>
		            	</div>
		            	<div class="row">
		            		<div class="form-group">
			            		<label class="control-label">轮播图片：</label>
			            		<input type="file" name="uploadfile" id="uploadfile" multiple class="file-loading form-control" />
			            	</div>
		            	</div>
		            </div>
		            </form>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
		                <button type="button" id="submitbtn" onclick="addGoods()" class="btn btn-primary">提交</button>
		            </div>
		        </div><!-- /.modal-content -->
		    </div><!-- /.modal -->
		</div>
        
        <div class="wrapper wrapper-content animated fadeInRight">
                
            <div class="row">
            <div class="col-lg-12">
            <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5>Editable Table in- combination with jEditable</h5>
                <div class="ibox-tools">
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                    <a class="close-link">
                        <i class="fa fa-times"></i>
                    </a>
                </div>
            </div>
            <div class="ibox-content">
	            <div class="">
		            <a  href="javascript:void(0);" data-toggle="modal" data-target="#addGoods" class="btn btn-primary ">新增</a>
		            <a  href="javascript:void(0);" data-toggle="modal" data-target="#addMenu" class="btn btn-warning ">修改</a>
		            <a  href="javascript:void(0);" data-toggle="modal" data-target="#addMenu" class="btn btn-danger ">删除</a>
	            </div>
            <table class="table table-striped table-bordered table-hover " id="editable" >
            <thead>
            <tr>
                <th style="text-align: center"></th>
                <th>商品名称</th>
                <th>品牌</th>
                <th>价格</th>
                <th>运费</th>
                <th>原价格</th>
                <th>商品描述</th>
                <th>商品规格</th>
                <th>分类</th>
                <th>状态</th>
                <th style="display:none">menuId</th>
            </tr>
            </thead>
            <tbody>
<!--             	<tr th:each="menu:${params.classified}"> -->
<!--             		<td style="display:none" th:text="${menu.id}"></td> -->
<!--             		<td th:text="${menu.menuName}"></td> -->
<!--             		<td th:text="${menu.parentName}"></td> -->
<!--             		<td style="display:none" th:text="${menu.parentId}"></td> -->
<!--             	</tr> -->
            </tbody>
            </table>

            </div>
            </div>
            </div>
            </div>
        </div>
        <div class="footer">
<!--             <div class="pull-right"> -->
<!--                 10GB of <strong>250GB</strong> Free. -->
<!--             </div> -->
            <div>
                <strong>Copyright</strong> 龙鑫出品 &copy; 2018-2019
            </div>
        </div>

        </div>
        </div>
        <!-- 等待动图 -->
		<div class="sk-circle" style="display: none;float:left;left:50%">
			        <div class="sk-circle1 sk-child"></div>
			        <div class="sk-circle2 sk-child"></div>
			        <div class="sk-circle3 sk-child"></div>
			        <div class="sk-circle4 sk-child"></div>
			        <div class="sk-circle5 sk-child"></div>
			        <div class="sk-circle6 sk-child"></div>
			        <div class="sk-circle7 sk-child"></div>
			        <div class="sk-circle8 sk-child"></div>
			        <div class="sk-circle9 sk-child"></div>
			        <div class="sk-circle10 sk-child"></div>
			        <div class="sk-circle11 sk-child"></div>
			        <div class="sk-circle12 sk-child"></div>
		 </div>
		 <!-- 遮罩 -->
		<div class="overlay" style="display: none"></div>

    <!-- Mainly scripts -->
    <script th:src="@{js/jquery-2.1.1.js}"></script>
    <script th:src="@{js/bootstrap.min.js}"></script>
    <script th:src="@{js/plugins/metisMenu/jquery.metisMenu.js}"></script>
    <script th:src="@{js/plugins/slimscroll/jquery.slimscroll.min.js}"></script>
    <script th:src="@{js/plugins/jeditable/jquery.jeditable.js}"></script>

    <script th:src="@{js/plugins/dataTables/datatables.min.js}"></script>

    <!-- Custom and plugin javascript -->
    <script th:src="@{js/inspinia.js}"></script>
    <script th:src="@{js/plugins/pace/pace.min.js}"></script>
    <script th:src="@{js/plugins/fileinput/sortable.min.js}" type="text/javascript"></script>
    <script th:src="@{js/fileinput.min.js}" type="text/javascript"></script>
    <script th:src="@{js/zh.js}" type="text/javascript"></script>
    <script th:src="@{js/bootstrapValidator.min.js}" type="text/javascript"></script>
    <script th:src="@{js/bootstrapValidator.min.extend.js}" type="text/javascript"></script>
    <script th:src="@{css/themes/explorer-fa/theme.min.js}"type="text/javascript"></script>
    <script th:src="@{css/themes/fa/theme.min.js}"type="text/javascript"></script>
<!-- 	<script th:src="@{js/plugins/dropzone/dropzone.js}"></script> -->
    <!-- Page-Level Scripts -->
    <script>
        $(document).ready(function(){
			validatorInit();
			fileinputInit("goodsimg");
			fileinputInit("uploadfile");
            lang = {
            	    "sProcessing": "处理中...",
            	    "sLengthMenu": "每页 _MENU_ 项",
            	    "sZeroRecords": "没有匹配结果",
            	    "sInfo": "当前显示第 _START_ 至 _END_ 项，共 _TOTAL_ 项。",
            	    "sInfoEmpty": "当前显示第 0 至 0 项，共 0 项",
            	    "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
            	    "sInfoPostFix": "",
            	    // "sSearch": "本地搜索：",
            	    "sUrl": "",
            	    "sEmptyTable": "暂无数据",
            	    "sLoadingRecords": "载入中...",
            	    "sInfoThousands": ",",
            	    "oPaginate": {
            	        "sFirst": "首页",
            	        "sPrevious": "上页",
            	        "sNext": "下页",
            	        "sLast": "末页",
            	        "sJump": "跳转"
            	    },
            	    "oAria": {
            	        "sSortAscending": ": 以升序排列此列",
            	        "sSortDescending": ": 以降序排列此列"
            	    }
            	};
            
            /* Init DataTables */
            var oTable = $('#editable').DataTable({
            	"processing" : true, //DataTables载入数据时，是否显示进度条
            	"oLanguage":lang,
            	serverSide: true,  //启用服务器端分页
            	renderer: "bootstrap",  //渲染样式：Bootstrap和jquery-ui
            	pagingType: "simple_numbers",  //分页样式：simple,simple_numbers,full,full_numbers
            	columnDefs: [{
                    "targets": 'sort',  //列的样式名
                    "orderable": true    //包含上样式名‘nosort’的禁止排序
                }],
                buttons: [
                    {extend: 'excel',title: 'ExampleFile'},
                    {extend: 'pdf',title: 'ExampleFile'},
                    {extend: 'print',
                     customize: function (win){
                            $(win.document.body).addClass('white-bg');
                            $(win.document.body).css('font-size', '10px');

                            $(win.document.body).find('table')
                                    .addClass('compact')
                                    .css('font-size', 'inherit');
                    }
                    }
                ],
            	stripeClasses: ["odd", "even"],  //为奇偶行加上样式，兼容不支持CSS伪类的场合
            	"ajax": function (data, callback, settings){  // ajax 请求数据
            		//封装请求参数
            		 var param = {};
            		 param.length = data.length;//页面显示记录条数，在页面显示每页显示多少项的时候
            		 param.start = data.start;//开始的记录序号
            		 param.draw = data.draw;//当前页码

            		 //ajax请求数据
            		 $.ajax({
            		     type: "POST",
            		     url: "goodsLoad",
            		     cache: false,  //禁用缓存
            		     data: param,
            		     dataType: "json",
            		     success: function (result) {
            		         //封装返回数据
            		         var returnData = {};
            		         returnData.draw = result.draw;//这里直接自行返回了draw计数器,应该由后台返回
            		         returnData.recordsTotal = result.recordsTotal;//返回数据全部记录
            		         returnData.recordsFiltered = result.recordsFiltered;//后台不实现过滤功能，每次查询均视作全部结果
            		         returnData.data = result.data;//返回的数据列表
            		         //调用DataTables提供的callback方法，代表数据已封装完成并传回DataTables进行渲染
            		         //此时的数据需确保正确无误，异常判断应在执行此回调前自行处理完毕
             		         callback(returnData);
            		     },
            		     error: function(msg){
            		    	 console.log(msg);
            		     }
            		 });
            	 },
            	 "columns":[
            		 {
            			 "data":"id",
           				 render(data, type, full, meta) { 
            				 	return '<input type="checkbox" class="checkchild" value="${data}" />';
                         }

            		 },
            		 {"data":"title"},
            		 {"data":"brand"},
            		 {"data":"price"},
            		 {"data":"carriage"},
            		 {"data":"oriPrice"},
            		 {"data":"desc"},
            		 {"data":"specification"},
            		 {"data":"menu.menuName"},
            		 {"data":"menu.id"}
            	 ]
            	
            });
        });

		
		function fileinputInit(id){
            	$("#"+id).fileinput({
                language: 'zh', //设置语言
                uploadUrl:"goodsImgUp", //上传的地址
                allowedFileTypes : [ 'image' ],//允许上传的文件类型
               allowedFileExtensions: ['jpg', 'jpeg', 'png','ico'],//接收的文件后缀
               //uploadExtraData:{"id": 1, "fileName":'123.mp3'},
                uploadAsync: true, //默认异步上传
                showUpload:false, //是否显示上传按钮
                showRemove :true, //显示移除按钮
                showPreview :false, //是否显示预览
                showCaption:true,//是否显示标题
                browseClass:"btn btn-primary", //按钮样式    
               dropZoneEnabled: true,//是否显示拖拽区域
               //minImageWidth: 50, //图片的最小宽度
               //minImageHeight: 50,//图片的最小高度
               //maxImageWidth: 1000,//图片的最大宽度
               //maxImageHeight: 1000,//图片的最大高度
                //maxFileSize:0,//单位为kb，如果为0表示不限制文件大小
               //minFileCount: 0,
                //maxFileCount:n, //表示允许同时上传的最大文件个数
                enctype:'multipart/form-data',
               validateInitialCount:true,
                previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
               msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！",
               initialCaption: "选择图片"
	           }).on('fileerror', function(event, data, msg) { //一个文件上传失败
	    			console.log('文件上传失败！'+msg);
	    		});
            }


        
       function validatorInit(){
       		$('#addForm').bootstrapValidator({
       			feedbackIcons:{
       				valid:'glyphicon glyphicon-ok',
       				invalid:'glyphicon glyphicon-remove',
       				validating:'glyphicon glyphicon-refresh',
       			},
       			fields:{
       				title:{
       					validators:{
       						notEmpty:{
       							message:"商品名称不可以为空"
       						},
       						stringLength:{
       							min:1,
       							max:25,
       							message:"商品名称长度不能少于1位，不能长于25位"
       						}
       					}
       				},
       				brand:{
       					validators:{
       						notEmpty:{
       							message:"品牌不可以为空"
       						},
       						stringLength:{
       							min:1,
       							max:20,
       							message:"品牌长度不能少于1位，不能长于20位"
       						}
       					}
       				},
       				price:{
       					validators:{
       						notEmpty:{
       							message:"价格不可以为空"
       						},
       						regexp:{
       							regexp: /(^[1-9][0-9]{0,9}(\.[0-9]{1,2}){0,1}$)|(^0$)|(^\d\.\d{1,2}$)/,
       							message:"价格以元为单位，整数部分最多10位，小数部分1～2位"
       						},
       						numCompare:{
       							min:0.01,
       							message:"价格最小值必须大于0"
       						}
       					}
       				},
       				oriPrice:{
       					validators:{
       						regexp:{
       							regexp: /(^[1-9][0-9]{0,9}(\.[0-9]{1,2}){0,1}$)|(^0$)|(^\d\.\d{1,2}$)/,
       							message:"原价格以元为单位，整数部分最多10位，小数部分1～2位"
       						}
       					//	callback : {
						//		callback : function(value, validator) {
						//			validator.updateStatus('accountnoConfirm', 'identical').validateField('accountnoConfirm');
						//			return true;
						//		}
						//	}
       					}
       				},
       				carriage:{
       					validators:{
       						regexp:{
       							regexp: /(^[1-9][0-9]{0,4}$)|(^0{1})$/,
       							message:"邮费以元为单位，只能为整数，长度最多5位"
       						}
       					}
       				},
       				inventory:{
       					validators:{
       						regexp:{
       							regexp: /(^[1-9][0-9]{0,10}$)/,
       							message:"库存为整数，最多10位"
       						},
       						numCompare:{
       							min:1,
       							message:"库存必须大于0"
       						}
       					}
       				},
       				specification:{
       					validators:{
       						notEmpty:{
       							message:"商品规格不可以为空"
       						},
       						stringLength:{
       							min:1,
       							max:200,
       							message:"商品规格长度不能少于1位，不能长于200位"
       						}
       					}
       				},
       				goodsDesc:{
       					validators:{
       						notEmpty:{
       							message:"商品描述不可以为空"
       						},
       						stringLength:{
       							min:1,
       							max:40,
       							message:"商品描述长度不能少于1位，不能长于200位"
       						}
       					}
       				},
       				goodsimg:{
       					validators:{
       						notEmpty: {
                        		message: '商品图片不能为空'
		                    },
		                    file: {
		                        extension: 'png,jpg,jpeg,ico',
		                        type: 'image/png,image/jpg,image/jpeg,image/ico',
		                        message: '请重新选择图片'
		                    }
       					}	
       				},
       				uploadfile:{
       					validators:{
       						notEmpty: {
                        		message: '轮播图片不能为空'
		                    },
		                    file: {
		                        extension: 'png,jpg,jpeg,ico',
		                        type: 'image/png,image/jpg,image/jpeg,image/ico',
		                        message: '请重新选择图片'
		                    }
       					}	
       				}
       			}
       		});
       }

		//商品新增
       function addGoods()
       {
       //禁用按钮
       		$('#submitbtn').attr('disable',false);
       		//验证表单
       		var validator = $('#addForm').data("bootstrapValidator");
       		if(!validator.isValid()){
       			$('#submitbtn').attr('disable',true);
       			return;
       		}
       		//取值
    	   var data = {
    	   			"title":$('#title').val(),
    			   "price":$('#price').val(),
    			   "brand":$('#brand').val(),
    			   "oriPrice":$('#oriPrice').val(),
    			   "carriage":$('#carriage').val(),
    			   "specification":$('#specification').val(),
    			   "goodsDesc":$('#goodsDesc').val(),
    			   "menuId":$('#menuId').val(),
    			   "inventory":$('#inventory').val()
    		};
    		//打开遮罩
    		$(".sk-circle").css("display","block");
    		$(".overlay").css("display","block");
    	   $.ajax({
    		data: JSON.stringify(data),
       		url:  "addGoods",
       		type: "POST",
       		contentType:"application/json",
       		success:function(data){
       			if(data.respcode!="000000"){
       				alert(data.respmsg);
       			}else {
	       			$("#goodsimg").fileinput('refresh',{
	       				uploadExtraData:{
	       					'id':data.id,
	       					'type':'goodsimg'
	       				}
	       			});
	       			$("#uploadfile").fileinput('refresh',{
	       				uploadExtraData:{
	       					'id':data.id,
	       					'type':'bannerImg'
	       				}
	       			});
	       			$("#goodsimg").fileinput('upload');
	       			$("#uploadfile").fileinput('upload');
	       			$("#title").val("");
	       			$("#price").val("");
	       			$("#oriPrice").val("0.00");
	       			$("#brand").val("");
	       			$("#carriage").val("0");
	       			$('#inventory').val("0");
	       			$("#specification").val("");
	       			$("#goodsDesc").val("");
	       			$("#uploadfile").fileinput('refresh').fileinput('enable');
	       			$("#menuId").select(0);
	       			$('#addGoods').modal('hide');
	       		}
       			$(".sk-circle").css("display","none");
    			$(".overlay").css("display","none");
       			$('#submitbtn').attr('disable',true);
       		},
       		error:function(msg){
       			$(".sk-circle").css("display","none");
    			$(".overlay").css("display","none");
       			$('#submitbtn').attr('disable',true);
       			console.log("商品添加失败"+msg)
       		}
    	   });
       }
        
       
    </script>

</body>

</html>
